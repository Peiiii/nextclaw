import { existsSync, mkdirSync, readFileSync, writeFileSync } from "node:fs";
import { dirname, resolve } from "node:path";
import { fileURLToPath } from "node:url";

const scriptDir = dirname(fileURLToPath(import.meta.url));
const pkgRoot = resolve(scriptDir, "..");
const source = resolve(pkgRoot, "..", "..", "docs", "USAGE.md");
const target = resolve(pkgRoot, "templates", "USAGE.md");

if (!existsSync(source)) {
  console.warn(`[sync-usage-template] source not found: ${source}`);
  process.exit(0);
}

const sourceContent = readFileSync(source, "utf-8");
const generatedHeader = [
  "<!-- Generated by packages/nextclaw/scripts/sync-usage-template.mjs -->",
  "<!-- Do not edit this file directly; edit docs/USAGE.md instead. -->",
  ""
].join("\n");

mkdirSync(dirname(target), { recursive: true });
writeFileSync(target, `${generatedHeader}${sourceContent}`);
console.log(`[sync-usage-template] synced ${source} -> ${target}`);
